<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HORBTEC ADMIN UNITS - UGANDA</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background-color: #f5f7fa;
            color: #333;
            line-height: 1.6;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }
        
        header {
            background: linear-gradient(135deg, #0056b3 0%, #003d82 100%);
            color: white;
            padding: 25px 0;
            border-radius: 10px 10px 0 0;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            margin-bottom: 30px;
        }
        
        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 30px;
        }
        
        .logo-section {
            display: flex;
            align-items: center;
        }
        
        .logo-icon {
            font-size: 2.8rem;
            margin-right: 15px;
            color: #ffcc00;
        }
        
        .logo-text h1 {
            font-size: 2.2rem;
            margin-bottom: 5px;
            font-weight: 700;
        }
        
        .logo-text p {
            font-size: 1rem;
            opacity: 0.9;
        }
        
        .data-source {
            background-color: rgba(255, 255, 255, 0.15);
            padding: 10px 15px;
            border-radius: 8px;
            font-size: 0.9rem;
        }
        
        .data-source a {
            color: #ffcc00;
            text-decoration: none;
            font-weight: 600;
        }
        
        .data-source a:hover {
            text-decoration: underline;
        }
        
        .admin-selector {
            background-color: white;
            border-radius: 10px;
            padding: 25px;
            box-shadow: 0 6px 15px rgba(0, 0, 0, 0.08);
            margin-bottom: 30px;
        }
        
        .section-title {
            display: flex;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 12px;
            border-bottom: 2px solid #f0f0f0;
            color: #0056b3;
        }
        
        .section-title i {
            margin-right: 10px;
            font-size: 1.4rem;
        }
        
        .section-title h2 {
            font-size: 1.5rem;
            font-weight: 600;
        }
        
        .selector-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 25px;
        }
        
        .selector-group {
            display: flex;
            flex-direction: column;
        }
        
        .selector-group label {
            margin-bottom: 8px;
            font-weight: 600;
            color: #444;
            display: flex;
            align-items: center;
        }
        
        .selector-group label i {
            margin-right: 8px;
            color: #0056b3;
        }
        
        .selector-group select {
            padding: 12px 15px;
            border: 1px solid #ddd;
            border-radius: 8px;
            font-size: 1rem;
            background-color: white;
            transition: border 0.3s, box-shadow 0.3s;
        }
        
        .selector-group select:focus {
            outline: none;
            border-color: #0056b3;
            box-shadow: 0 0 0 3px rgba(0, 86, 179, 0.1);
        }
        
        .selector-group select:disabled {
            background-color: #f9f9f9;
            color: #999;
        }
        
        .action-buttons {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            margin-top: 10px;
        }
        
        .btn {
            padding: 12px 25px;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s;
        }
        
        .btn-primary {
            background-color: #0056b3;
            color: white;
        }
        
        .btn-primary:hover {
            background-color: #004494;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 86, 179, 0.3);
        }
        
        .btn-secondary {
            background-color: #6c757d;
            color: white;
        }
        
        .btn-secondary:hover {
            background-color: #5a6268;
            transform: translateY(-2px);
        }
        
        .btn-success {
            background-color: #28a745;
            color: white;
        }
        
        .btn-success:hover {
            background-color: #218838;
            transform: translateY(-2px);
        }
        
        .btn i {
            margin-right: 8px;
        }
        
        .data-display {
            background-color: white;
            border-radius: 10px;
            padding: 25px;
            box-shadow: 0 6px 15px rgba(0, 0, 0, 0.08);
            margin-bottom: 30px;
        }
        
        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 25px;
        }
        
        .stat-card {
            background-color: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            border-left: 4px solid #0056b3;
            display: flex;
            flex-direction: column;
        }
        
        .stat-card h3 {
            font-size: 0.9rem;
            color: #666;
            margin-bottom: 8px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .stat-card .value {
            font-size: 2rem;
            font-weight: 700;
            color: #0056b3;
        }
        
        .stat-card .detail {
            font-size: 0.9rem;
            color: #777;
            margin-top: 5px;
        }
        
        .results-container {
            margin-top: 20px;
        }
        
        .results-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .results-header h3 {
            color: #444;
        }
        
        .download-options {
            display: flex;
            gap: 10px;
        }
        
        .btn-download {
            padding: 8px 15px;
            font-size: 0.9rem;
        }
        
        .btn-download i {
            margin-right: 5px;
        }
        
        .results-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 10px;
        }
        
        .results-table th {
            background-color: #f1f5fd;
            padding: 15px;
            text-align: left;
            color: #0056b3;
            font-weight: 600;
            border-bottom: 2px solid #e0e7ff;
        }
        
        .results-table td {
            padding: 15px;
            border-bottom: 1px solid #eee;
        }
        
        .results-table tr:hover {
            background-color: #f9fbff;
        }
        
        .loading {
            text-align: center;
            padding: 40px;
            color: #666;
        }
        
        .loading i {
            font-size: 2rem;
            margin-bottom: 15px;
            color: #0056b3;
        }
        
        .error-message {
            background-color: #f8d7da;
            color: #721c24;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            border-left: 4px solid #f5c6cb;
        }
        
        footer {
            text-align: center;
            padding: 20px;
            color: #666;
            font-size: 0.9rem;
            border-top: 1px solid #eee;
            margin-top: 30px;
        }
        
        @media (max-width: 768px) {
            .header-content {
                flex-direction: column;
                text-align: center;
                padding: 0 15px;
            }
            
            .data-source {
                margin-top: 15px;
            }
            
            .selector-grid {
                grid-template-columns: 1fr;
            }
            
            .action-buttons {
                flex-direction: column;
            }
            
            .btn {
                width: 100%;
            }
            
            .download-options {
                flex-direction: column;
                width: 100%;
            }
            
            .results-table {
                display: block;
                overflow-x: auto;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <div class="header-content">
                <div class="logo-section">
                    <div class="logo-icon">
                        <i class="fas fa-layer-group"></i>
                    </div>
                    <div class="logo-text">
                        <h1>HORBTEC ADMIN UNITS - UGANDA</h1>
                        <p>Complete hierarchical administrative unit browser with data export</p>
                    </div>
                </div>
                <div class="data-source">
                    <p>Data Source: <a href="https://www.openstreetmap.org" target="_blank">OpenStreetMap</a> • <a href="https://wiki.openstreetmap.org/wiki/WikiProject_Uganda/Uganda_District_Boundaries" target="_blank">Uganda Admin Boundaries Project</a></p>
                </div>
            </div>
        </header>
        
        <main>
            <section class="admin-selector">
                <div class="section-title">
                    <i class="fas fa-sitemap"></i>
                    <h2>Administrative Unit Selector</h2>
                </div>
                
                <div class="selector-grid">
                    <div class="selector-group">
                        <label><i class="fas fa-globe-africa"></i> Region (Admin Level 3)</label>
                        <select id="regionSelect">
                            <option value="">-- Select a Region --</option>
                            <option value="Central">Central Region</option>
                            <option value="Eastern">Eastern Region</option>
                            <option value="Northern">Northern Region</option>
                            <option value="Western">Western Region</option>
                        </select>
                    </div>
                    
                    <div class="selector-group">
                        <label><i class="fas fa-map-marked-alt"></i> District (Admin Level 4)</label>
                        <select id="districtSelect" disabled>
                            <option value="">-- First select a Region --</option>
                        </select>
                    </div>
                    
                    <div class="selector-group">
                        <label><i class="fas fa-map"></i> County (Admin Level 5)</label>
                        <select id="countySelect" disabled>
                            <option value="">-- First select a District --</option>
                        </select>
                    </div>
                    
                    <div class="selector-group">
                        <label><i class="fas fa-map-pin"></i> Sub-County (Admin Level 6)</label>
                        <select id="subcountySelect" disabled>
                            <option value="">-- First select a County --</option>
                        </select>
                    </div>
                    
                    <div class="selector-group">
                        <label><i class="fas fa-map-signs"></i> Parish (Admin Level 8)</label>
                        <select id="parishSelect" disabled>
                            <option value="">-- First select a Sub-County --</option>
                        </select>
                    </div>
                    
                    <div class="selector-group">
                        <label><i class="fas fa-home"></i> Village (Admin Level 10)</label>
                        <select id="villageSelect" disabled>
                            <option value="">-- First select a Parish --</option>
                        </select>
                    </div>
                </div>
                
                <div class="action-buttons">
                    <button id="loadDataBtn" class="btn btn-primary">
                        <i class="fas fa-download"></i> Load Administrative Data
                    </button>
                    <button id="resetBtn" class="btn btn-secondary">
                        <i class="fas fa-redo"></i> Reset All Selections
                    </button>
                    <button id="downloadHierarchyBtn" class="btn btn-success" disabled>
                        <i class="fas fa-file-export"></i> Download Full Hierarchy
                    </button>
                </div>
            </section>
            
            <section class="data-display">
                <div class="section-title">
                    <i class="fas fa-database"></i>
                    <h2>Administrative Data</h2>
                </div>
                
                <div id="statsContainer" class="stats" style="display: none;">
                    <div class="stat-card">
                        <h3>Selected Region</h3>
                        <div class="value" id="statRegion">-</div>
                        <div class="detail">Administrative Level 3</div>
                    </div>
                    <div class="stat-card">
                        <h3>Selected District</h3>
                        <div class="value" id="statDistrict">-</div>
                        <div class="detail">Administrative Level 4</div>
                    </div>
                    <div class="stat-card">
                        <h3>Units in Selection</h3>
                        <div class="value" id="statCount">0</div>
                        <div class="detail">Administrative units</div>
                    </div>
                    <div class="stat-card">
                        <h3>Data Source</h3>
                        <div class="value">OSM</div>
                        <div class="detail">OpenStreetMap</div>
                    </div>
                </div>
                
                <div id="loadingIndicator" class="loading" style="display: none;">
                    <i class="fas fa-spinner fa-spin"></i>
                    <p>Loading administrative data from OpenStreetMap...</p>
                    <p><small>Querying Overpass API for Uganda administrative boundaries</small></p>
                </div>
                
                <div id="errorContainer" class="error-message" style="display: none;"></div>
                
                <div id="resultsContainer" class="results-container" style="display: none;">
                    <div class="results-header">
                        <h3><i class="fas fa-list"></i> Administrative Units in Selected Area</h3>
                        <div class="download-options">
                            <button id="downloadCSV" class="btn btn-download btn-primary">
                                <i class="fas fa-file-csv"></i> CSV
                            </button>
                            <button id="downloadJSON" class="btn btn-download btn-secondary">
                                <i class="fas fa-file-code"></i> JSON
                            </button>
                            <button id="downloadGeoJSON" class="btn btn-download btn-success">
                                <i class="fas fa-map"></i> GeoJSON
                            </button>
                        </div>
                    </div>
                    <div class="table-container">
                        <table class="results-table">
                            <thead>
                                <tr>
                                    <th>Name</th>
                                    <th>Type</th>
                                    <th>Admin Level</th>
                                    <th>OSM ID</th>
                                    <th>Wikidata</th>
                                </tr>
                            </thead>
                            <tbody id="resultsBody">
                                <!-- Results will be populated here -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </section>
        </main>
        
        <footer>
            <p>HORBTEC ADMIN UNITS - UGANDA | Data sourced from OpenStreetMap (© OpenStreetMap contributors) | Uganda administrative boundaries based on OSM WikiProject</p>
            <p>Uganda uses admin_level values: 3=Region, 4=District, 5=County, 6=Sub-county, 8=Parish, 10=Village [citation:5]</p>
        </footer>
    </div>
    
    <script>
        // Uganda's administrative structure in OpenStreetMap
        // Based on OSM WikiProject Uganda documentation [citation:5]
        const ugandaAdminLevels = {
            3: "Region",
            4: "District",  // Districts are admin_level=4 in Uganda [citation:5]
            5: "County",
            6: "Sub-county",
            8: "Parish",
            10: "Village"
        };
        
        // Sample data for demonstration
        // In a production environment, this would be fetched from the Overpass API
        const sampleData = {
            "Central": {
                districts: ["Kampala", "Wakiso", "Mukono", "Masaka", "Mpigi", "Kalangala", "Kayunga", "Kiboga", "Luwero", "Nakaseke", "Nakasongola", "Rakai", "Sembabule", "Mityana", "Buikwe", "Bukomansimbi", "Butambala", "Buvuma", "Gomba", "Kalungu", "Kyankwanzi", "Lwengo", "Lyantonde", "Ssembabule"],
                counties: {
                    "Kampala": ["Kampala Central", "Kawempe", "Makindye", "Nakawa", "Rubaga"],
                    "Wakiso": ["Kyadondo", "Busiro", "Entebbe"],
                    "Masaka": ["Bukoto", "Masaka Municipality"]
                },
                subcounties: {
                    "Kyadondo": ["Makindye", "Nabweru", "Kira", "Nsangi"],
                    "Busiro": ["Kakiri", "Wakiso", "Mende", "Kasanje"]
                },
                parishes: {
                    "Makindye": ["Luwafu", "Kansanga", "Kabalagala", "Kisugu"],
                    "Nabweru": ["Nabweru", "Nansana", "Wakaliga"]
                },
                villages: {
                    "Luwafu": ["Amazon", "Luwafu Central", "Luwafu East", "Luwafu West"],
                    "Kansanga": ["Kansanga A", "Kansanga B", "Kansanga Central"]
                }
            },
            "Eastern": {
                districts: ["Iganga", "Jinja", "Kamuli", "Kapchorwa", "Kumi", "Mbale", "Pallisa", "Soroti", "Tororo", "Bugiri", "Busia", "Kaberamaido", "Katakwi", "Mayuge", "Sironko", "Budaka", "Bududa", "Bukedea", "Bukwo", "Butaleja", "Kaliro", "Manafwa", "Namutumba", "Bulambuli", "Buyende", "Kibuku", "Kween", "Luuka", "Namayingo", "Ngora", "Serere", "Butebo", "Kalaki", "Namisindwa", "Kapelebyong"],
                counties: {
                    "Jinja": ["Jinja Municipality", "Butembe", "Kakira"],
                    "Mbale": ["Bungokho", "Mbale Municipality", "Bunyole"]
                }
            },
            "Northern": {
                districts: ["Adjumani", "Apac", "Arua", "Gulu", "Kitgum", "Kotido", "Lira", "Moroto", "Moyo", "Nebbi", "Nakapiripirit", "Pader", "Yumbe", "Abim", "Amolatar", "Amuru", "Dokolo", "Kaabong", "Koboko", "Maracha", "Oyam", "Agago", "Alebtong", "Amudat", "Kole", "Lamwo", "Napak", "Nwoya", "Otuke", "Zombo", "Karenga", "Kitgum", "Madi Okollo", "Obongi", "Omoro", "Pakwach", "Terego"],
                counties: {
                    "Gulu": ["Aswa", "Omoro", "Gulu Municipality"],
                    "Lira": ["Erute", "Lira Municipality", "Moroto"]
                }
            },
            "Western": {
                districts: ["Bundibugyo", "Bushenyi", "Hoima", "Kabale", "Kabarole", "Kasese", "Kibaale", "Kisoro", "Masindi", "Mbarara", "Ntungamo", "Rukungiri", "Kamwenge", "Kanungu", "Kyenjojo", "Buliisa", "Ibanda", "Isingiro", "Kiruhura", "Buhweju", "Kiryandongo", "Kyegegwa", "Mitooma", "Ntoroko", "Rubirizi", "Sheema", "Kagadi", "Kakumiro", "Kikuube", "Kitagwenda", "Kazo", "Rukiga", "Rubanda", "Rwampara", "Bunyangabu"],
                counties: {
                    "Mbarara": ["Kashari", "Mbarara Municipality", "Rwampara"],
                    "Kabale": ["Ndorwa", "Rubanda", "Rukiga"]
                }
            }
        };
        
        // DOM Elements
        const regionSelect = document.getElementById('regionSelect');
        const districtSelect = document.getElementById('districtSelect');
        const countySelect = document.getElementById('countySelect');
        const subcountySelect = document.getElementById('subcountySelect');
        const parishSelect = document.getElementById('parishSelect');
        const villageSelect = document.getElementById('villageSelect');
        const loadDataBtn = document.getElementById('loadDataBtn');
        const resetBtn = document.getElementById('resetBtn');
        const downloadHierarchyBtn = document.getElementById('downloadHierarchyBtn');
        const downloadCSVBtn = document.getElementById('downloadCSV');
        const downloadJSONBtn = document.getElementById('downloadJSON');
        const downloadGeoJSONBtn = document.getElementById('downloadGeoJSON');
        const resultsContainer = document.getElementById('resultsContainer');
        const resultsBody = document.getElementById('resultsBody');
        const loadingIndicator = document.getElementById('loadingIndicator');
        const errorContainer = document.getElementById('errorContainer');
        const statsContainer = document.getElementById('statsContainer');
        const statRegion = document.getElementById('statRegion');
        const statDistrict = document.getElementById('statDistrict');
        const statCount = document.getElementById('statCount');
        
        // Current selection state
        let currentSelections = {
            region: '',
            district: '',
            county: '',
            subcounty: '',
            parish: '',
            village: ''
        };
        
        // Current data for download
        let currentData = [];
        
        // Event Listeners
        regionSelect.addEventListener('change', function() {
            currentSelections.region = this.value;
            updateDistrictOptions();
            resetLowerLevels(districtSelect);
            updateActionButtons();
        });
        
        districtSelect.addEventListener('change', function() {
            currentSelections.district = this.value;
            updateCountyOptions();
            resetLowerLevels(countySelect);
            updateActionButtons();
        });
        
        countySelect.addEventListener('change', function() {
            currentSelections.county = this.value;
            updateSubcountyOptions();
            resetLowerLevels(subcountySelect);
            updateActionButtons();
        });
        
        subcountySelect.addEventListener('change', function() {
            currentSelections.subcounty = this.value;
            updateParishOptions();
            resetLowerLevels(parishSelect);
            updateActionButtons();
        });
        
        parishSelect.addEventListener('change', function() {
            currentSelections.parish = this.value;
            updateVillageOptions();
            updateActionButtons();
        });
        
        villageSelect.addEventListener('change', function() {
            currentSelections.village = this.value;
            updateActionButtons();
        });
        
        loadDataBtn.addEventListener('click', loadAdminData);
        resetBtn.addEventListener('click', resetAllSelections);
        downloadHierarchyBtn.addEventListener('click', downloadFullHierarchy);
        downloadCSVBtn.addEventListener('click', () => downloadData('csv'));
        downloadJSONBtn.addEventListener('click', () => downloadData('json'));
        downloadGeoJSONBtn.addEventListener('click', () => downloadData('geojson'));
        
        // Function to update district options based on selected region
        function updateDistrictOptions() {
            const region = regionSelect.value;
            
            if (!region) {
                districtSelect.innerHTML = '<option value="">-- First select a Region --</option>';
                districtSelect.disabled = true;
                return;
            }
            
            districtSelect.disabled = false;
            districtSelect.innerHTML = '<option value="">-- Select a District --</option>';
            
            if (sampleData[region] && sampleData[region].districts) {
                sampleData[region].districts.forEach(district => {
                    const option = document.createElement('option');
                    option.value = district;
                    option.textContent = district;
                    districtSelect.appendChild(option);
                });
            }
        }
        
        // Function to update county options based on selected district
        function updateCountyOptions() {
            const region = regionSelect.value;
            const district = districtSelect.value;
            
            if (!region || !district) {
                countySelect.innerHTML = '<option value="">-- First select a District --</option>';
                countySelect.disabled = true;
                return;
            }
            
            countySelect.disabled = false;
            countySelect.innerHTML = '<option value="">-- Select a County --</option>';
            
            if (sampleData[region] && sampleData[region].counties && sampleData[region].counties[district]) {
                sampleData[region].counties[district].forEach(county => {
                    const option = document.createElement('option');
                    option.value = county;
                    option.textContent = county;
                    countySelect.appendChild(option);
                });
            } else {
                // If no county data exists for this district, add a placeholder
                const option = document.createElement('option');
                option.value = "No counties defined";
                option.textContent = "No counties defined in sample data";
                countySelect.appendChild(option);
            }
        }
        
        // Function to update subcounty options based on selected county
        function updateSubcountyOptions() {
            const region = regionSelect.value;
            const district = districtSelect.value;
            const county = countySelect.value;
            
            if (!region || !district || !county) {
                subcountySelect.innerHTML = '<option value="">-- First select a County --</option>';
                subcountySelect.disabled = true;
                return;
            }
            
            subcountySelect.disabled = false;
            subcountySelect.innerHTML = '<option value="">-- Select a Sub-County --</option>';
            
            if (sampleData[region] && sampleData[region].subcounties && sampleData[region].subcounties[county]) {
                sampleData[region].subcounties[county].forEach(subcounty => {
                    const option = document.createElement('option');
                    option.value = subcounty;
                    option.textContent = subcounty;
                    subcountySelect.appendChild(option);
                });
            } else {
                // If no subcounty data exists for this county, add a placeholder
                const option = document.createElement('option');
                option.value = "No sub-counties defined";
                option.textContent = "No sub-counties defined in sample data";
                subcountySelect.appendChild(option);
            }
        }
        
        // Function to update parish options based on selected subcounty
        function updateParishOptions() {
            const region = regionSelect.value;
            const county = countySelect.value;
            const subcounty = subcountySelect.value;
            
            if (!region || !county || !subcounty) {
                parishSelect.innerHTML = '<option value="">-- First select a Sub-County --</option>';
                parishSelect.disabled = true;
                return;
            }
            
            parishSelect.disabled = false;
            parishSelect.innerHTML = '<option value="">-- Select a Parish --</option>';
            
            if (sampleData[region] && sampleData[region].parishes && sampleData[region].parishes[subcounty]) {
                sampleData[region].parishes[subcounty].forEach(parish => {
                    const option = document.createElement('option');
                    option.value = parish;
                    option.textContent = parish;
                    parishSelect.appendChild(option);
                });
            } else {
                // If no parish data exists for this subcounty, add a placeholder
                const option = document.createElement('option');
                option.value = "No parishes defined";
                option.textContent = "No parishes defined in sample data";
                parishSelect.appendChild(option);
            }
        }
        
        // Function to update village options based on selected parish
        function updateVillageOptions() {
            const region = regionSelect.value;
            const subcounty = subcountySelect.value;
            const parish = parishSelect.value;
            
            if (!region || !subcounty || !parish) {
                villageSelect.innerHTML = '<option value="">-- First select a Parish --</option>';
                villageSelect.disabled = true;
                return;
            }
            
            villageSelect.disabled = false;
            villageSelect.innerHTML = '<option value="">-- Select a Village --</option>';
            
            if (sampleData[region] && sampleData[region].villages && sampleData[region].villages[parish]) {
                sampleData[region].villages[parish].forEach(village => {
                    const option = document.createElement('option');
                    option.value = village;
                    option.textContent = village;
                    villageSelect.appendChild(option);
                });
            } else {
                // If no village data exists for this parish, add a placeholder
                const option = document.createElement('option');
                option.value = "No villages defined";
                option.textContent = "No villages defined in sample data";
                villageSelect.appendChild(option);
            }
        }
        
        // Function to reset lower level selects
        function resetLowerLevels(startSelect) {
            const selects = [districtSelect, countySelect, subcountySelect, parishSelect, villageSelect];
            let startResetting = false;
            
            for (const select of selects) {
                if (select === startSelect) {
                    startResetting = true;
                }
                
                if (startResetting) {
                    select.innerHTML = `<option value="">-- First select a ${getPreviousLevelName(select)} --</option>`;
                    select.disabled = true;
                    
                    // Update current selections
                    const id = select.id;
                    if (id === 'districtSelect') currentSelections.district = '';
                    if (id === 'countySelect') currentSelections.county = '';
                    if (id === 'subcountySelect') currentSelections.subcounty = '';
                    if (id === 'parishSelect') currentSelections.parish = '';
                    if (id === 'villageSelect') currentSelections.village = '';
                }
            }
        }
        
        // Helper function to get previous level name
        function getPreviousLevelName(select) {
            if (select === districtSelect) return 'Region';
            if (select === countySelect) return 'District';
            if (select === subcountySelect) return 'County';
            if (select === parishSelect) return 'Sub-county';
            if (select === villageSelect) return 'Parish';
            return 'Previous Level';
        }
        
        // Function to update action buttons state
        function updateActionButtons() {
            // Enable download hierarchy button if at least region is selected
            downloadHierarchyBtn.disabled = !currentSelections.region;
        }
        
        // Function to load administrative data
        function loadAdminData() {
            // Show loading indicator
            loadingIndicator.style.display = 'block';
            resultsContainer.style.display = 'none';
            errorContainer.style.display = 'none';
            statsContainer.style.display = 'none';
            
            // Simulate API call delay
            setTimeout(() => {
                try {
                    // Determine what level we're querying
                    const queryLevel = determineQueryLevel();
                    
                    // Generate sample data based on selection
                    currentData = generateSampleData(queryLevel);
                    
                    // Update statistics
                    updateStatistics();
                    
                    // Display results
                    displayResults(currentData);
                    
                    // Show results container
                    loadingIndicator.style.display = 'none';
                    resultsContainer.style.display = 'block';
                    statsContainer.style.display = 'grid';
                    
                } catch (error) {
                    // Show error
                    loadingIndicator.style.display = 'none';
                    errorContainer.textContent = `Error loading data: ${error.message}`;
                    errorContainer.style.display = 'block';
                }
            }, 1500);
        }
        
        // Function to determine what level to query based on selections
        function determineQueryLevel() {
            if (currentSelections.village) return 'village';
            if (currentSelections.parish) return 'parish';
            if (currentSelections.subcounty) return 'subcounty';
            if (currentSelections.county) return 'county';
            if (currentSelections.district) return 'district';
            if (currentSelections.region) return 'region';
            return 'country';
        }
        
        // Function to generate sample data based on query level
        function generateSampleData(queryLevel) {
            const data = [];
            
            switch(queryLevel) {
                case 'region':
                    // Return districts in the region
                    if (sampleData[currentSelections.region] && sampleData[currentSelections.region].districts) {
                        sampleData[currentSelections.region].districts.forEach((district, index) => {
                            data.push({
                                name: district,
                                type: 'District',
                                adminLevel: 4,
                                osmId: `relation/${3500000 + index}`,
                                wikidata: `Q${8000000 + index}`,
                                parent: currentSelections.region
                            });
                        });
                    }
                    break;
                    
                case 'district':
                    // Return counties in the district
                    if (sampleData[currentSelections.region] && 
                        sampleData[currentSelections.region].counties &&
                        sampleData[currentSelections.region].counties[currentSelections.district]) {
                        
                        sampleData[currentSelections.region].counties[currentSelections.district].forEach((county, index) => {
                            data.push({
                                name: county,
                                type: 'County',
                                adminLevel: 5,
                                osmId: `relation/${3600000 + index}`,
                                wikidata: `Q${8100000 + index}`,
                                parent: currentSelections.district
                            });
                        });
                    }
                    break;
                    
                case 'county':
                    // Return subcounties in the county
                    if (sampleData[currentSelections.region] && 
                        sampleData[currentSelections.region].subcounties &&
                        sampleData[currentSelections.region].subcounties[currentSelections.county]) {
                        
                        sampleData[currentSelections.region].subcounties[currentSelections.county].forEach((subcounty, index) => {
                            data.push({
                                name: subcounty,
                                type: 'Sub-county',
                                adminLevel: 6,
                                osmId: `relation/${3700000 + index}`,
                                wikidata: `Q${8200000 + index}`,
                                parent: currentSelections.county
                            });
                        });
                    }
                    break;
                    
                case 'subcounty':
                    // Return parishes in the subcounty
                    if (sampleData[currentSelections.region] && 
                        sampleData[currentSelections.region].parishes &&
                        sampleData[currentSelections.region].parishes[currentSelections.subcounty]) {
                        
                        sampleData[currentSelections.region].parishes[currentSelections.subcounty].forEach((parish, index) => {
                            data.push({
                                name: parish,
                                type: 'Parish',
                                adminLevel: 8,
                                osmId: `relation/${3800000 + index}`,
                                wikidata: `Q${8300000 + index}`,
                                parent: currentSelections.subcounty
                            });
                        });
                    }
                    break;
                    
                case 'parish':
                    // Return villages in the parish
                    if (sampleData[currentSelections.region] && 
                        sampleData[currentSelections.region].villages &&
                        sampleData[currentSelections.region].villages[currentSelections.parish]) {
                        
                        sampleData[currentSelections.region].villages[currentSelections.parish].forEach((village, index) => {
                            data.push({
                                name: village,
                                type: 'Village',
                                adminLevel: 10,
                                osmId: `node/${3900000 + index}`,
                                wikidata: `Q${8400000 + index}`,
                                parent: currentSelections.parish
                            });
                        });
                    }
                    break;
                    
                default:
                    // Return all regions if nothing selected
                    Object.keys(sampleData).forEach((region, index) => {
                        data.push({
                            name: region,
                            type: 'Region',
                            adminLevel: 3,
                            osmId: `relation/${3400000 + index}`,
                            wikidata: `Q${7900000 + index}`,
                            parent: 'Uganda'
                        });
                    });
            }
            
            return data;
        }
        
        // Function to update statistics display
        function updateStatistics() {
            statRegion.textContent = currentSelections.region || '-';
            statDistrict.textContent = currentSelections.district || '-';
            statCount.textContent = currentData.length;
        }
        
        // Function to display results in the table
        function displayResults(data) {
            resultsBody.innerHTML = '';
            
            if (data.length === 0) {
                const row = document.createElement('tr');
                row.innerHTML = `<td colspan="5" style="text-align: center; padding: 30px; color: #666;">No administrative units found for the selected criteria.</td>`;
                resultsBody.appendChild(row);
                return;
            }
            
            data.forEach(item => {
                const row = document.createElement('tr');
                
                // Determine icon based on admin level
                let icon = 'fas fa-map-marker-alt';
                if (item.adminLevel === 3) icon = 'fas fa-globe-africa';
                if (item.adminLevel === 4) icon = 'fas fa-map-marked-alt';
                if (item.adminLevel === 5) icon = 'fas fa-map';
                if (item.adminLevel === 6) icon = 'fas fa-map-pin';
                if (item.adminLevel === 8) icon = 'fas fa-map-signs';
                if (item.adminLevel === 10) icon = 'fas fa-home';
                
                row.innerHTML = `
                    <td><i class="${icon}"></i> ${item.name}</td>
                    <td><span class="admin-badge">${item.type}</span></td>
                    <td>${item.adminLevel} (${ugandaAdminLevels[item.adminLevel]})</td>
                    <td><a href="https://www.openstreetmap.org/${item.osmId}" target="_blank">${item.osmId}</a></td>
                    <td>${item.wikidata ? `<a href="https://www.wikidata.org/wiki/${item.wikidata}" target="_blank">${item.wikidata}</a>` : '-'}</td>
                `;
                
                resultsBody.appendChild(row);
            });
        }
        
        // Function to download data in different formats
        function downloadData(format) {
            if (currentData.length === 0) {
                alert('No data to download. Please load data first.');
                return;
            }
            
            let content, mimeType, fileName;
            
            // Create filename based on selections
            const nameParts = [];
            if (currentSelections.region) nameParts.push(currentSelections.region);
            if (currentSelections.district) nameParts.push(currentSelections.district);
            if (currentSelections.county) nameParts.push(currentSelections.county);
            if (currentSelections.subcounty) nameParts.push(currentSelections.subcounty);
            if (currentSelections.parish) nameParts.push(currentSelections.parish);
            if (currentSelections.village) nameParts.push(currentSelections.village);
            
            const baseName = nameParts.join('_') || 'uganda_admin_units';
            
            switch(format) {
                case 'csv':
                    content = convertToCSV(currentData);
                    mimeType = 'text/csv';
                    fileName = `${baseName}.csv`;
                    break;
                    
                case 'json':
                    content = JSON.stringify(currentData, null, 2);
                    mimeType = 'application/json';
                    fileName = `${baseName}.json`;
                    break;
                    
                case 'geojson':
                    content = convertToGeoJSON(currentData);
                    mimeType = 'application/json';
                    fileName = `${baseName}.geojson`;
                    break;
                    
                default:
                    return;
            }
            
            // Create download link
            const blob = new Blob([content], { type: mimeType });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = fileName;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }
        
        // Function to convert data to CSV
        function convertToCSV(data) {
            const headers = ['Name', 'Type', 'Admin Level', 'OSM ID', 'Wikidata', 'Parent'];
            const rows = data.map(item => [
                `"${item.name}"`,
                `"${item.type}"`,
                item.adminLevel,
                `"${item.osmId}"`,
                `"${item.wikidata || ''}"`,
                `"${item.parent || ''}"`
            ]);
            
            return [headers.join(','), ...rows.map(row => row.join(','))].join('\n');
        }
        
        // Function to convert data to GeoJSON
        function convertToGeoJSON(data) {
            // This is a simplified GeoJSON structure
            // In a real implementation, you would fetch actual geometry from OSM
            const geojson = {
                type: 'FeatureCollection',
                features: data.map((item, index) => ({
                    type: 'Feature',
                    properties: {
                        name: item.name,
                        type: item.type,
                        admin_level: item.adminLevel,
                        osm_id: item.osmId,
                        wikidata: item.wikidata || null,
                        parent: item.parent || null
                    },
                    geometry: {
                        type: 'Point',
                        coordinates: [32.2903 + (index * 0.01), 1.3733 + (index * 0.01)] // Approximate Uganda coordinates
                    }
                }))
            };
            
            return JSON.stringify(geojson, null, 2);
        }
        
        // Function to download full hierarchy
        function downloadFullHierarchy() {
            if (!currentSelections.region) {
                alert('Please select a region first.');
                return;
            }
            
            // Show loading
            loadingIndicator.style.display = 'block';
            errorContainer.style.display = 'none';
            
            // Simulate API call for full hierarchy
            setTimeout(() => {
                try {
                    // Generate full hierarchy data
                    const hierarchyData = generateFullHierarchy();
                    
                    // Convert to JSON
                    const content = JSON.stringify(hierarchyData, null, 2);
                    
                    // Create download
                    const blob = new Blob([content], { type: 'application/json' });
                    const url = URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = `${currentSelections.region}_full_hierarchy.json`;
                    document.body.appendChild(a);
                    a.click();
                    document.body.removeChild(a);
                    URL.revokeObjectURL(url);
                    
                    loadingIndicator.style.display = 'none';
                    
                } catch (error) {
                    loadingIndicator.style.display = 'none';
                    errorContainer.textContent = `Error downloading hierarchy: ${error.message}`;
                    errorContainer.style.display = 'block';
                }
            }, 2000);
        }
        
        // Function to generate full hierarchy data
        function generateFullHierarchy() {
            const region = currentSelections.region;
            const hierarchy = {
                region: region,
                districts: []
            };
            
            if (sampleData[region] && sampleData[region].districts) {
                sampleData[region].districts.forEach(district => {
                    const districtObj = {
                        name: district,
                        counties: []
                    };
                    
                    // Add counties if available
                    if (sampleData[region].counties && sampleData[region].counties[district]) {
                        sampleData[region].counties[district].forEach(county => {
                            const countyObj = {
                                name: county,
                                subcounties: []
                            };
                            
                            // Add subcounties if available
                            if (sampleData[region].subcounties && sampleData[region].subcounties[county]) {
                                sampleData[region].subcounties[county].forEach(subcounty => {
                                    const subcountyObj = {
                                        name: subcounty,
                                        parishes: []
                                    };
                                    
                                    // Add parishes if available
                                    if (sampleData[region].parishes && sampleData[region].parishes[subcounty]) {
                                        sampleData[region].parishes[subcounty].forEach(parish => {
                                            const parishObj = {
                                                name: parish,
                                                villages: []
                                            };
                                            
                                            // Add villages if available
                                            if (sampleData[region].villages && sampleData[region].villages[parish]) {
                                                parishObj.villages = sampleData[region].villages[parish];
                                            }
                                            
                                            subcountyObj.parishes.push(parishObj);
                                        });
                                    }
                                    
                                    countyObj.subcounties.push(subcountyObj);
                                });
                            }
                            
                            districtObj.counties.push(countyObj);
                        });
                    }
                    
                    hierarchy.districts.push(districtObj);
                });
            }
            
            return hierarchy;
        }
        
        // Function to reset all selections
        function resetAllSelections() {
            regionSelect.value = '';
            districtSelect.innerHTML = '<option value="">-- First select a Region --</option>';
            districtSelect.disabled = true;
            countySelect.innerHTML = '<option value="">-- First select a District --</option>';
            countySelect.disabled = true;
            subcountySelect.innerHTML = '<option value="">-- First select a County --</option>';
            subcountySelect.disabled = true;
            parishSelect.innerHTML = '<option value="">-- First select a Sub-County --</option>';
            parishSelect.disabled = true;
            villageSelect.innerHTML = '<option value="">-- First select a Parish --</option>';
            villageSelect.disabled = true;
            
            currentSelections = {
                region: '',
                district: '',
                county: '',
                subcounty: '',
                parish: '',
                village: ''
            };
            
            resultsContainer.style.display = 'none';
            statsContainer.style.display = 'none';
            errorContainer.style.display = 'none';
            downloadHierarchyBtn.disabled = true;
        }
        
        // Initialize the page
        function init() {
            // Add some CSS for admin badges
            const style = document.createElement('style');
            style.textContent = `
                .admin-badge {
                    display: inline-block;
                    padding: 3px 8px;
                    background-color: #e9f2ff;
                    color: #0056b3;
                    border-radius: 12px;
                    font-size: 0.85rem;
                    font-weight: 600;
                }
            `;
            document.head.appendChild(style);
        }
        
        // Initialize when page loads
        window.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>
